# 个人健康知识图谱系统功能文档

## 1. 简介

本文档旨在详细说明个人健康知识图谱系统的各项功能，定义系统如何满足用户需求，并作为后续技术开发、测试和验收的依据。该系统旨在通过采集用户的健康相关数据（如医患对话），利用大型语言模型（LLM）和知识图谱技术，构建个人健康档案，并提供可视化展示、健康分析与运营监控等功能。

**核心目标**

- **个性化健康档案**: 为每位用户构建一个动态、全面的个人健康知识图谱。
- **智能化信息提取**: 自动从非结构化的医患对话中提取关键健康信息。
- **可视化洞察**: 以直观的图谱和看板形式展示用户的健康状况和历史变迁。
- **数据驱动决策**: 为用户和医生提供更全面、结构化的健康信息，辅助决策。

## 2. 用户角色与职责

系统主要涉及以下三类用户角色：

| 角色 | 核心职责 |
| :--- | :--- |
| **普通用户/患者** | - 查看个人健康档案、知识图谱和健康时间线。<br>- 接收系统基于其健康数据生成的个性化提醒或建议。 |
| **医生/健康顾问** | - 在用户授权下，访问用户的知识图谱，以全面了解其病史、症状和生活习惯。<br>- 利用系统提供的结构化信息，为用户提供更精准的诊断和建议。 |
| **系统管理员/运营人员** | - 监控系统整体运行状态，包括数据处理流程、服务可用性和知识提取质量。<br>- 管理和维护医学术语库，提升知识提取的准确性。<br>- 查看运营看板，分析用户增长、系统使用情况等宏观指标。 |

## 3. 系统功能模块

系统将按照模块化方式构建，各模块既分工明确又协同工作，确保前端网页可以分阶段、清晰地对每一步进行查看和验收。

### 3.1. 阶段一：数据采集与处理核心

此阶段为系统的基础，目标是建立核心的数据流入和处理管道，为后续所有功能提供数据支持。

- **功能点 1：数据采集接口**
  - **描述**: 系统提供安全的API接口，用于接收和存储来自不同渠道的原始数据，当前主要聚焦于“电话医生”等医患对话记录。
  - **用户故事**: 作为系统，我能接收并安全地存储用户授权的通话记录文本。
  - **前端验收标准**: 页面上可以模拟上传一段对话文本，提交后系统返回“上传成功”的状态，并在后台数据库中可查到对应记录。

- **功能点 2：知识提取服务**
  - **描述**: 系统后台部署一个由大型语言模型（LLM）驱动的知识提取服务。该服务能从上传的对话文本中，自动识别和提取预定义的健康相关实体（如症状、疾病、药物）和它们之间的关系。
  - **用户故事**: 作为系统，我能自动分析一段对话，并抽取出其中提到的“头痛”、“高血压”等关键信息。
  - **前端验收标准**: 在一个简单的调试页面上，输入一段对话，点击“提取”按钮后，页面以JSON或表格形式清晰地展示提取出的实体和关系列表，包括实体名称、类型、置信度和原文来源。

### 3.2. 阶段二：个人健康图谱构建与可视化

在核心数据处理能力具备后，此阶段聚焦于将提取出的“知识”进行结构化存储，并以用户友好的方式呈现。

- **功能点 3：知识图谱构建**
  - **描述**: 系统将知识提取服务输出的实体和关系，自动存入图数据库（Neo4j），并与相应的用户关联，形成个人健康知识图谱。系统能处理知识的增量更新和潜在冲突。
  - **用户故事**: 作为用户，我每次的新的通话记录都能被系统分析，并自动更新到我的个人健康档案中。
  - **前端验收标准**: 在用户详情页，可以看到一个“处理新对话”的按钮。点击后，系统后台运行处理流程，处理完成后，刷新页面，新的健康信息（如新诊断的疾病）会体现在用户的健康概览中。

- **功能点 4：个人健康图谱可视化**
  - **描述**: 用户可以在个人中心查看自己的健康知识图谱。图谱以节点和连线的形式，直观展示用户的症状、疾病、用药史等信息及其相互关联。
  - **用户故事**: 作为用户，我想查看我的“高血压”都与哪些症状有关联，以及我为此吃过哪些药。
  - **前端验收标准**: 提供一个专门的“我的健康图谱”页面。进入后，可以看到一个交互式的图谱，节点（如“用户”、“高血压”、“头痛”）和关系（如“患有”、“症状是”）清晰可见。用户可以拖动、缩放图谱，点击节点可以查看详细信息（如诊断日期、症状描述）。

### 3.3. 阶段三：健康看板与运营监控

在提供核心的个人健康档案功能后，此阶段着重于提供更宏观的分析视图和系统运维能力。

- **功能点 5：个人健康看板**
  - **描述**: 系统为用户提供一个“健康概览”看板，以卡片和图表的形式，汇总展示用户的核心健康指标，如当前症状、确诊疾病、用药情况统计，以及一条按时间倒序排列的“健康时间线”。
  - **用户故事**: 作为用户，我希望一打开应用就能快速了解我当前的整体健康状况和最近发生的重要健康事件。
  - **前端验收标准**: 在用户首页，可以看到多个信息卡片，分别显示“当前症状数”、“确诊疾病数”等。下方有一个列表或时间轴，展示最近的健康事件，如“2024-01-15：因头痛咨询王医生”。

- **功能点 6：运营分析看板**
  - **描述**: 为系统管理员和运营人员提供一个后台看板，用于监控系统的核心性能指标（KPIs），如知识提取的准确率、数据处理的延迟、系统覆盖的用户总数等。
  - **用户故事**: 作为管理员，我想知道过去24小时系统处理了多少次对话，以及LLM提取的平均置信度是多少。
  - **前端验收标准**: 在一个受密码保护的后台管理页面，可以看到多个实时更新的图表，分别展示“系统可用性”、“知识新鲜度”、“用户覆盖率”等关键指标。

## 4. 分阶段验收方案

为了确保项目开发的透明性和可控性,系统开发将分为三个主要阶段,每个阶段都有明确的交付物和前端可验收的功能。

### 阶段一:数据采集与处理核心(1-2个月)

**目标**:建立系统的数据流入和智能处理能力,为后续功能打下坚实基础。

**核心功能交付**:
- 数据采集接口能够接收并存储对话记录。
- 知识提取服务能够从对话中自动提取实体和关系。

**前端验收页面**:
- **对话上传页面**:提供一个简洁的表单,允许测试人员输入或上传一段医患对话文本。提交后,页面显示"上传成功",并返回一个唯一的会话ID。
- **知识提取调试页面**:在该页面输入会话ID或直接粘贴对话文本,点击"提取知识"按钮后,页面以表格形式展示提取出的所有实体(包括名称、类型、置信度、原文来源)和关系(包括关系类型、起点、终点、置信度)。该页面允许开发和测试人员直观地评估提取质量。

**验收标准**:
- 能够成功上传至少10条不同类型的对话记录,并在数据库中查询到相应记录。
- 对于一组预定义的测试对话,知识提取的准确率(实体识别和关系抽取)达到80%以上。

### 阶段二:个人健康图谱构建与可视化(2-3个月)

**目标**:将提取的知识结构化存储为图谱,并提供用户友好的可视化界面。

**核心功能交付**:
- 知识图谱构建逻辑能够将提取结果存入Neo4j,并处理增量更新和冲突。
- 用户可以通过前端页面查看自己的个人健康知识图谱。

**前端验收页面**:
- **用户详情页**:展示用户的基本信息,并提供一个"处理新对话"按钮。点击后,系统后台异步处理该用户最新的对话记录,并更新其知识图谱。页面提供处理状态的实时反馈(如"处理中"、"完成")。
- **我的健康图谱页面**:这是一个交互式的图谱可视化页面。用户登录后,可以看到以自己为中心的健康知识网络。节点代表不同的健康实体(如症状、疾病、药物),连线代表它们之间的关系。用户可以通过拖动、缩放、点击节点来探索图谱。点击任一节点,侧边栏会弹出该实体的详细信息(如诊断日期、症状描述、用药剂量)。

**验收标准**:
- 对于一个测试用户,连续处理3次不同的对话记录后,其知识图谱能够正确反映所有提及的健康信息,且没有重复的实体节点。
- 可视化页面能够在2秒内加载并渲染包含至少50个节点和100条关系的图谱,且交互流畅无卡顿。

### 阶段三:健康看板与运营监控(1-2个月)

**目标**:提供宏观的健康分析视图和系统运营监控能力,提升用户体验和系统可维护性。

**核心功能交付**:
- 用户可以通过健康看板快速了解自己的整体健康状况和历史变迁。
- 管理员可以通过运营看板监控系统的关键性能指标。

**前端验收页面**:
- **个人健康看板**:用户登录后的首页。页面顶部以卡片形式展示关键统计数据,如"当前症状:3个"、"确诊疾病:1个"、"正在使用的药物:2种"。下方是一条"健康时间线",按时间倒序列出用户的重要健康事件,如"2024-01-15:因头痛咨询王医生",点击事件可查看详情。
- **运营分析看板**:仅管理员可访问的后台页面。页面包含多个图表,实时展示系统的核心指标,如过去24小时处理的对话数量、平均知识提取置信度、系统API的响应时间分布、当前在线用户数等。每个图表都支持自定义时间范围查询。

**验收标准**:
- 个人健康看板能够准确汇总用户的健康数据,且时间线中的事件与实际对话记录时间一致。
- 运营看板中的所有图表能够实时(延迟不超过1分钟)反映系统的运行状态,且数据与后台日志和数据库记录一致。

## 5. 非功能性需求

除了上述功能性需求,系统还需满足以下非功能性要求,以确保其在生产环境中的可靠性、安全性和可扩展性。

### 5.1. 性能要求

系统需要在合理的资源配置下,满足以下性能指标:

- **API响应时间**:对于简单的查询请求(如获取用户基本信息),95%的请求应在200ms内返回。
- **知识提取延迟**:对于一段标准长度(约10分钟)的对话,从提交到完成知识提取和图谱更新,端到端时间应控制在30秒以内。
- **并发能力**:系统应能同时处理至少100个并发用户的请求,而不出现明显的性能下降或超时。

### 5.2. 安全性要求

鉴于系统处理的是敏感的个人健康数据,必须采取严格的安全措施:

- **数据加密**:所有存储在数据库中的敏感数据(如用户姓名、联系方式、病史)必须进行加密存储。数据在传输过程中(客户端与服务器之间)必须使用HTTPS协议。
- **身份认证与授权**:系统必须实现基于角色的访问控制(RBAC)。普通用户只能访问自己的数据,医生需要用户明确授权后才能查看其健康图谱,管理员拥有系统配置和监控权限。
- **审计日志**:系统应记录所有对敏感数据的访问和修改操作,包括操作者、时间、操作类型等,以便于事后审计和问题追溯。

### 5.3. 可扩展性要求

系统架构应支持未来的功能扩展和用户规模增长:

- **模块化设计**:各功能模块(数据采集、知识提取、图谱存储、可视化)应保持低耦合,便于独立升级和替换。例如,未来可以轻松地将LLM服务从OpenAI切换为本地部署的开源模型。
- **水平扩展**:后端API服务和任务队列(Celery workers)应支持水平扩展,即通过增加服务器实例来应对用户量和数据量的增长。
- **数据库扩展**:MongoDB和Neo4j都应配置为集群模式,以支持数据的分片和副本,确保高可用性和数据安全。

### 5.4. 可维护性要求

为了降低长期运维成本,系统应具备良好的可维护性:

- **代码质量**:代码应遵循统一的编码规范,关键模块需要有充分的单元测试和集成测试覆盖。
- **文档完善**:除了本功能文档和技术文档外,还应提供详细的API文档(如使用Swagger自动生成)、部署手册和运维手册。
- **监控与告警**:系统应集成完善的监控体系,对关键指标设置阈值告警,以便运维人员及时发现和处理异常。

## 6. 术语表

为了确保文档的准确理解,以下列出了本文档中使用的关键术语及其定义:

| 术语 | 定义 |
| :--- | :--- |
| **知识图谱(Knowledge Graph)** | 一种以图结构组织和表示知识的方式,由节点(实体)和边(关系)组成,用于描述现实世界中的概念及其相互联系。 |
| **实体(Entity)** | 知识图谱中的节点,代表一个具体的对象或概念,如"高血压"、"阿司匹林"。 |
| **关系(Relationship)** | 知识图谱中的边,描述两个实体之间的联系,如"患有"、"治疗"。 |
| **LLM(Large Language Model)** | 大型语言模型,一种基于深度学习的自然语言处理模型,能够理解和生成人类语言,本系统中用于从文本中提取结构化知识。 |
| **Neo4j** | 一个高性能的原生图数据库,专为存储和查询图结构数据而设计。 |
| **MongoDB** | 一个面向文档的NoSQL数据库,适合存储灵活、半结构化的数据。 |
| **FastAPI** | 一个现代、高性能的Python Web框架,用于构建API服务。 |
| **Celery** | 一个基于分布式消息传递的异步任务队列,用于处理耗时的后台任务。 |
| **置信度(Confidence)** | 一个0到1之间的数值,表示系统对某个提取结果(如实体或关系)准确性的信心程度。 |

## 7. 附录

### 7.1. 参考资料

本系统的设计参考了以下领域的最佳实践和学术研究:

- **知识图谱构建**:参考了Google Knowledge Graph和医疗领域知识图谱(如UMLS、SNOMED CT)的设计理念。
- **自然语言处理**:借鉴了命名实体识别(NER)和关系抽取(RE)领域的最新研究成果。
- **图数据库应用**:遵循了Neo4j官方推荐的图模型设计模式。

### 7.2. 未来展望

在完成上述三个阶段的开发后,系统还有以下潜在的扩展方向:

- **多模态数据支持**:除了文本对话,未来可以支持医疗影像、检验报告等多种数据源。
- **智能健康助手**:基于用户的知识图谱,提供个性化的健康建议和风险预警。
- **医学知识库集成**:将用户的个人知识图谱与公共医学知识库(如疾病数据库、药物数据库)进行关联,提供更丰富的信息。
- **隐私计算**:引入联邦学习或同态加密等技术,在保护用户隐私的前提下,实现多方数据的协同分析。

---

**文档版本**:v1.0  
**编写日期**:2024年  
**编写者**:Manus AI
